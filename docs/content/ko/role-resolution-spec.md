# 역할 해결 사양

## 핵심 공식

```python
effective_role = max(
    manual_override,
    github_role,
    oidc_role
)

access_allowed = (
    oidc_gate_passed
    AND effective_role != none
)
```
## 해상도 입력

- `manual_override`: 명시적인 관리자 관리 예외입니다.
- `github_role`: GitHub 권한 동기화에서 해결되었습니다.
- `oidc_role`: OIDC 그룹 파생 부스트 역할.
- `oidc_gate_passed`: 인증 + 작업공간 게이트 성공.

## 역할 계층

### 작업공간 역할

| 순위 | 역할 |
|---|---|
| 3 | 소유자 |
| 2 | 관리자 |
| 1 | 회원 |
| 0 | 없음 |

### 프로젝트 역할

| 순위 | 역할 |
|---|---|
| 4 | 소유자 |
| 3 | 관리자 |
| 2 | 작가 |
| 1 | 독자 |
| 0 | 없음 |

## 충돌 해결 규칙

1. 직급별로 역할을 비교해보세요.
2. 가장 높은 순위를 `effective_role`으로 선택하세요.
3. OIDC 접근 확인에 실패하면 계산된 역할과 관계없이 접근을 거부합니다.
4. 역할 확인 전에 작업공간 격리를 적용하세요.

## 소유자 보호 규칙

자동 동기화는 중요한 소유권을 맹목적으로 제거할 수 없습니다.

- 보호 규칙이 활성화되면 자동화에 의한 프로젝트 소유자 제거가 차단됩니다.
- 작업 공간 소유자/관리자 재정의는 긴급 작업에도 유효합니다.

## `add_and_remove` 행동

`add_and_remove`은 전체 조정을 적용합니다.

- 소스에서 누락된 보조금 추가
- 변경된 보조금 업데이트
- 오래된 보조금 제거
- 보호된 소유자 제거 건너뛰기

`add_only`은 추가 동기화를 적용합니다.

- 누락된 보조금 추가
- 필요할 때 업그레이드
- 오래된 항목을 제거하지 마십시오

## 수동 재정의 정책

수동 재정의는 예외적인 경우에만 적용됩니다.

- 파생 보조금보다 순위가 높습니다.
- 감사가 가능해야 합니다.
- 운영정책은 시간제한이 있어야 한다.

# 운영 접근 통제

## 목표

이 런북은 안정적인 작업 공간 온보딩 및 액세스 제어 관리를 위한 작업 순서를 정의합니다.

## 새로운 작업공간 온보딩

1. 작업공간을 생성합니다.
2. 작업공간에 GitHub 앱 설치를 연결합니다.
3. 저장소 동기화를 실행합니다.
4. repo -> 프로젝트 링크를 확인하세요.
5. 권한 동기화를 실행합니다(시험 실행 후 적용).
6. OIDC 공급자를 연결하고 로그인 액세스 확인을 확인합니다.
7. 그룹 매핑을 구성합니다(부스트 정책에만 해당).
8. 설정 작업에 대한 감사 추적을 확인합니다.

## GitHub 설정 절차

### 설치 및 동기화

1. 작업공간 GitHub 통합 페이지를 엽니다.
2. 설치를 연결합니다.
3. 저장소 동기화를 클릭합니다.
4. 연결된 프로젝트를 확인합니다.

### 권한 동기화

1. 테스트 실행을 실행합니다.
2. 비교할 수 없는 사용자를 검토합니다.
3. 사용자(`Claustrum user <-> GitHub login`)를 연결합니다.
4. 동기화 적용을 실행합니다.

## OIDC 설정 절차

1. OIDC 공급자 메타데이터를 구성합니다.
2. 발급자 및 클라이언트 구성을 확인합니다.
3. `(issuer, subject)` ID 생성을 확인합니다.
4. 안정적인 그룹 ID로 그룹 매핑을 구성합니다.
5. 보호된 엔드포인트에서 OIDC 액세스 확인 시행을 확인합니다.

## 팀 매핑 절차

1. 팀 매핑 규칙을 등록합니다.
2. 대상 범위(워크스페이스/프로젝트)를 설정합니다.
3. 역할과 우선순위를 설정하세요.
4. 동기화를 트리거하거나 웹훅 기반 재계산을 기다립니다.
5. 결과 멤버십을 확인합니다.

## 사건 디버깅 순서

진단 소음을 줄이려면 다음 순서를 사용하십시오.

1. 해당 사용자의 OIDC 접속 확인 성공 여부를 확인합니다.
2. 워크스페이스 멤버십을 확인하세요.
3. GitHub 설치가 존재하고 정상인지 확인합니다.
4. 저장소가 동기화되고 연결되었는지 확인합니다.
5. GitHub 사용자 링크가 있는지 확인합니다.
6. 직접/팀 최대 결과에 대한 권한 미리보기를 검사합니다.
7. 웹훅 전달(`queued/processing/done/failed`)을 검사합니다.
8. 재계산 감사 및 권한 적용 감사를 검사합니다.

## 감사 로그 확인

모니터링해야 할 중요한 동작 키:

- `github.webhook.received`
- `github.webhook.signature_failed`
- `github.repos.synced`
- `github.repos.synced.webhook`
- `github.permissions.computed`
- `github.permissions.applied`
- `github.permissions.recomputed`
- `github.user_link.created`
- `github.user_link.deleted`

## 운영상의 안전 조치

- 초기 출시 시 `add_only`을 기본값으로 유지합니다.
- 감사 신뢰도가 확립된 후 `add_and_remove`을 사용하십시오.
- 소유자 보호를 활성화된 상태로 유지하세요.
- 부분 재계산을 사용하여 영향 범위를 제한합니다.

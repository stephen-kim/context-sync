# =============================
# Claustrum Environment File
# =============================
# 1) Copy this file and use it as .env:
#    cp .env.example .env
#
# 2) Choose a compose mode:
#    - Image-based (production/Dockge): docker compose up -d
#      (default file: docker-compose.yml)
#    - Source-build (local development): docker compose -f docker-compose.dev.yml up -d
#
# 3) memory-core always uses DATABASE_URL for DB connection.
#    POSTGRES_* is used only for localdb postgres container initialization.

# -------------------------------------------------------------------
# Required: Database connection
# -------------------------------------------------------------------
# Scenario A (localdb profile): use postgres service name inside containers
DATABASE_URL=postgres://<db_user>:<db_password>@postgres:5432/<db_name>

# Scenario B (external DB/RDS): replace DATABASE_URL with e.g.
# DATABASE_URL=postgres://<db_user>:<db_password>@<rds-endpoint>:5432/<db_name>?sslmode=require

# Localdb profile only (dev-only postgres container init)
POSTGRES_DB=<db_name>
POSTGRES_USER=<db_user>
POSTGRES_PASSWORD=<db_password>

# -------------------------------------------------------------------
# Required: memory-core runtime/auth
# -------------------------------------------------------------------
MEMORY_CORE_HOST=0.0.0.0
MEMORY_CORE_PORT=8080
MEMORY_CORE_LOG_LEVEL=error

# Required runtime key for memory-core REST auth
MEMORY_CORE_API_KEY=<replace-with-runtime-key>

# Optional: alternate form for multiple runtime keys (comma-separated)
MEMORY_CORE_API_KEYS=

# Required when running `pnpm db:seed` (used to upsert admin key in DB)
MEMORY_CORE_SEED_ADMIN_KEY=<replace-with-seed-key>

# Optional: bootstrap admin controls (first-run only)
# If true and users table is empty, memory-core creates admin@example.com
# and prints one-time initial password to stderr.
MEMORY_CORE_ALLOW_BOOTSTRAP_ADMIN=true

# Optional: session auth secret for /v1/auth/login tokens (set a strong value in production)
MEMORY_CORE_AUTH_SESSION_SECRET=<replace-with-strong-session-secret>
# Optional: session token TTL in seconds (default 43200 = 12h)
MEMORY_CORE_AUTH_SESSION_TTL_SECONDS=43200
# Optional but strongly recommended: secret for API key hashing (HMAC-SHA256)
MEMORY_CORE_API_KEY_HASH_SECRET=<replace-with-strong-hash-secret>
# Optional but strongly recommended: secret for one-time key view tokens
MEMORY_CORE_ONE_TIME_TOKEN_SECRET=<replace-with-strong-one-time-token-secret>
# Optional: one-time key link TTL seconds (default 900 = 15m)
MEMORY_CORE_ONE_TIME_TOKEN_TTL_SECONDS=900
# Optional: public base URL used when generating one-time key links
MEMORY_CORE_PUBLIC_BASE_URL=http://localhost:8080
# Optional: base URL for invite links (set to Admin UI URL, e.g. http://localhost:3000)
MEMORY_CORE_INVITE_BASE_URL=http://localhost:3000
# Optional: override secret for signed GitHub installation state token
# (defaults to MEMORY_CORE_AUTH_SESSION_SECRET when unset)
MEMORY_CORE_GITHUB_STATE_SECRET=

# -------------------------------------------------------------------
# Optional: GitHub App integration (workspace-level installation + repo sync)
# -------------------------------------------------------------------
# GITHUB_APP_PRIVATE_KEY supports:
# - raw PEM
# - PEM with escaped newlines (\n)
# - base64-encoded PEM
# Web UI configurable: No (server-side only)
GITHUB_APP_ID=
GITHUB_APP_PRIVATE_KEY=
GITHUB_APP_WEBHOOK_SECRET=
# Provide either app name or full app URL for installation link generation
GITHUB_APP_NAME=
GITHUB_APP_URL=

# -------------------------------------------------------------------
# Required: service-to-service/browser endpoints
# -------------------------------------------------------------------
# mcp-adapter -> memory-core (container-internal address)
# git hook forwarder (src/hook-event.ts) also uses this value to call /v1/git-events
# (also injected into hooks installed by set_project(enable_git_hooks=true) in root claustrum)
MEMORY_CORE_URL=http://memory-core:8080
MEMORY_CORE_WORKSPACE_KEY=personal
MCP_ADAPTER_LOG_LEVEL=error

# Admin UI public URL (must be browser-reachable, usually localhost/domain)
NEXT_PUBLIC_MEMORY_CORE_URL=http://localhost:8080
ADMIN_UI_PORT=3000

# -------------------------------------------------------------------
# Optional: image tag overrides for image-based compose
# -------------------------------------------------------------------
# Default when unset: ghcr.io/stephen-kim/claustrum-*:latest
# Set only when using custom fork/org images
# MEMORY_CORE_IMAGE=ghcr.io/<your-org>/claustrum-memory-core:latest
# MCP_ADAPTER_IMAGE=ghcr.io/<your-org>/claustrum-mcp-adapter:latest
# ADMIN_UI_IMAGE=ghcr.io/<your-org>/claustrum-admin-ui:latest

# -------------------------------------------------------------------
# Optional: lock integration providers to env-only mode
# -------------------------------------------------------------------
# Special values:
# - all  => force ENV-only for all integration providers
# - none => ignore ENV integration settings (DB/Admin UI only)
# Default precedence for most providers: Admin UI workspace config > env fallback
# Audit reasoner precedence: ENV > Admin UI workspace config
# If listed, Admin UI writes for that provider are blocked and env is forced
# Comma-separated: notion,jira,confluence,linear,slack,audit_reasoner
MEMORY_CORE_INTEGRATION_LOCKED_PROVIDERS=

# -------------------------------------------------------------------
# Optional: Slack audit forwarding
# -------------------------------------------------------------------
# If set, audit events are sent asynchronously to Slack (never blocks API response)
# Use action prefixes to reduce noise (comma-separated), e.g.
# workspace_settings.,project_mapping.,integration.,git.,ci.
# Web UI configurable: Yes (workspace-level Slack settings in Admin UI can override env fallback)
MEMORY_CORE_AUDIT_SLACK_WEBHOOK_URL=
MEMORY_CORE_AUDIT_SLACK_ACTION_PREFIXES=
MEMORY_CORE_AUDIT_SLACK_DEFAULT_CHANNEL=
MEMORY_CORE_AUDIT_SLACK_FORMAT=detailed
MEMORY_CORE_AUDIT_SLACK_INCLUDE_TARGET_JSON=true
MEMORY_CORE_AUDIT_SLACK_MASK_SECRETS=true

# -------------------------------------------------------------------
# Optional: Notion integration (read/search + optional write)
# -------------------------------------------------------------------
# Web UI configurable: Yes (workspace-level)
MEMORY_CORE_NOTION_TOKEN=
MEMORY_CORE_NOTION_DEFAULT_PARENT_PAGE_ID=
MEMORY_CORE_NOTION_WRITE_ENABLED=false

# -------------------------------------------------------------------
# Optional: Jira integration (read/search)
# -------------------------------------------------------------------
# Atlassian Cloud example base URL: https://<your-org>.atlassian.net
# Web UI configurable: Yes (workspace-level)
MEMORY_CORE_JIRA_BASE_URL=
MEMORY_CORE_JIRA_EMAIL=
MEMORY_CORE_JIRA_API_TOKEN=

# -------------------------------------------------------------------
# Optional: Confluence integration (read/search)
# -------------------------------------------------------------------
# Base URL can be https://<your-org>.atlassian.net or .../wiki
# Web UI configurable: Yes (workspace-level)
MEMORY_CORE_CONFLUENCE_BASE_URL=
MEMORY_CORE_CONFLUENCE_EMAIL=
MEMORY_CORE_CONFLUENCE_API_TOKEN=

# -------------------------------------------------------------------
# Optional: Linear integration (read/search)
# -------------------------------------------------------------------
# Web UI configurable: Yes (workspace-level)
MEMORY_CORE_LINEAR_API_KEY=
# Optional: endpoint override (default: https://api.linear.app/graphql)
MEMORY_CORE_LINEAR_API_URL=

# -------------------------------------------------------------------
# Optional: Audit reasoner integration (AI-generated concise reasons)
# -------------------------------------------------------------------
# Generates concise "why changed" audit reasons asynchronously (non-blocking)
# Priority: ENV > Admin UI workspace setting
# Web UI configurable: Yes (workspace-level)
MEMORY_CORE_AUDIT_REASONER_ENABLED=false
MEMORY_CORE_AUDIT_REASONER_PROVIDER=
MEMORY_CORE_AUDIT_REASONER_MODEL=
MEMORY_CORE_AUDIT_REASONER_API_KEY=
MEMORY_CORE_AUDIT_REASONER_BASE_URL=

# Optional: convenience API key fallbacks when provider is inferred
OPENAI_API_KEY=
ANTHROPIC_API_KEY=
CLAUDE_API_KEY=
GEMINI_API_KEY=
